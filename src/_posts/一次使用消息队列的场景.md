---
category: Other
tags: []
title: 一次使用消息队列的场景
date: 2021-12-10 12:00:00 +0000
permalink: "/posts/202112101.html"

---
## 背景

公司有自由品牌，在第三方平台如天猫、快手、抖音等品牌建设有品牌直营店，其中天猫是目前单量最大的一块，我们一次交易的流程大致如此：用户在天猫下单-->数据同步到erp平台-->订单审核-->拉订单进入自研系统-->进行待履约、发货-->通过API接口同步发货到天猫，正向流程大致如此，逆向流程大致也是这样，通过erp平台同步售后数据，再拉取到自研系统，处理完再同步到第三方平台。

在这过程中，会存在erp平台漏单情况，或者自研系统的订单状态和第三方平台不一致情况，如换货单漏单，订单漏单等，而我们研发不能第一时间发现这些订单，多数是客服找到我们告知这些订单，一方面造成了用户体验不好，售后不能得到及时的处理，另一方面可能造成公司的损失，如天猫换货转退货退款，但自研系统中仍是换货导致发出换货商品，而天猫已把钱退给用户。

因此，需要做一个较为完备的监控

## 初开始

故事还得从八月份说起。做了几个月的业务线被砍掉，我们小组四个人转移到了订单业务，初开始工作压力很大，有太多东西需要了解，其中有一个是同步聚石塔rds数据库数据用作监控。

聚石塔可以简单的理解为，是淘宝专门为商家推出的云服务。其中，数据同步服务产品通过使用聚石塔中的云数据库，可以实现将天猫/淘宝的订单、商品、退款等主要数据直接实时、准确地推送给用户，即存储到RDS。

由于数据安全性问题，这个RDS只能够在聚石塔购买的服务器内连接，想要做监控，必须要将咱们系统中的数据和RDS都拿到一起做比对，那时候的想法很幼稚，一周也没想到一个好的方案，最终还是导师给出的解决方案。