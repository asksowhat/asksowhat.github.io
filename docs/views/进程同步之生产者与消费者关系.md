---
title: 进程同步之生产者与消费者关系
date: 2019-06-01 14:54:18
tags: 
    - 进程
categories:
          - Other
---
社会发展到今天，电子产品一天也离不开我们的生活。通常程序(APP)是不可以并发运行的，如果并发运行将会因为程序执行速度的不同，结果就不可控制了，但是日常生活中我们常需要程序一起运行，例如我想听歌，还想查看网页，进程概念由此而生。<!--more-->

## 什么是进程

进程的定义，站在不同的角度就会有不同的定义，较为经典的有以下几种。
1. 进程是程序的一次执行。
2. 进程是一个程序及其数据在处理机上顺序执行时所发生的活动。
3. 进程是具有独立功能的程序在一个数据集合上运行的过程，它是系统进行资源分配和调度的一个基本单位。

在引入了`进程实体`概念之后，传统OS中的定义为：**进程是进程实体的运行过程，是系统进行资源分配和调度的一个独立单位**。

### 什么进程实体？

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="321px" viewBox="-0.5 -0.5 321 111" content="&lt;mxfile host=&quot;www.draw.io&quot; modified=&quot;2020-01-19T08:36:36.410Z&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36&quot; etag=&quot;OYrCtrXJdhrCq8EmDKEw&quot; version=&quot;12.5.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;DFkQXq8wpZT_TQNl8Rwg&quot; name=&quot;第 1 页&quot;&gt;1ZbBTuMwEIafZo5ISdymzrFuXbisFAm0cEOmmU0iuXXluk26T782cZqEgAAJFjjF/j0eez7/jgxksakvtdgVv1SGEqIgq4EsIYrCMJnaj1NOjRIHUSPkusx8UCdcl3/Ri4FXD2WG+0GgUUqacjcU12q7xbUZaEJrVQ3D/ig5XHUnchwJ12shx+ptmZmiUWk06/QrLPOiXTmMk2ZkI9pgX8m+EJmqehLhQBZaKdO0NvUCpYPXcmnmrV4YPW9M49a8ZcLsJj2mRXX3UE/kRfqb3qTp/YXPchTy4AsGToGtIGHAZzCnQG1jCnMOCQc+AbaEhPiCzKmlZFeyB4I+GWqD9Yu7DM+1W9Og2qDRJxviJ0SBx3Vq+0236sH3UtHjTrwm/HHn58QdEdvwUN4BKHoGUI8LmwNdAY8dIDYdcdHqsM3Q5Q+BsA/AQ4d0wuCL8ZAxnpE3MnuhfBflg6p4J7BHwQ44KKW9dWdKbtaA0V4d9Bpft7IROkfz+om+gblGKUx5HO7jwxFOnnWYvX+MOodRazLiHGb/pCxwDbp0bvt0qz29iV/utenP89rkm3ktHiFMF+zzrUSib2al2c+zUvzfrGS73avkcaz3tiP8Hw==&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:111px;"><defs/><g><ellipse cx="160" cy="15" rx="40" ry="15" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="159.5" y="19.5">进程实体</text></g><rect x="0" y="80" width="80" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="39.5" y="99.5">程序段</text></g><path d="M 160 30 L 160 45 Q 160 55 150 55 L 50 55 Q 40 55 40 64.32 L 40 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 40 78.88 L 36.5 71.88 L 40 73.63 L 43.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="120" y="80" width="80" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="159.5" y="99.5">相关数据</text></g><path d="M 160 30 L 160 45 Q 160 55 160 64.32 L 160 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 160 78.88 L 156.5 71.88 L 160 73.63 L 163.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="80" width="80" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="279.5" y="99.5">PCB</text></g><path d="M 160 30 L 160 45 Q 160 55 170 55 L 270 55 Q 280 55 280 64.32 L 280 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 280 78.88 L 276.5 71.88 L 280 73.63 L 283.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/></g></svg>

由程序段，相关数据段和PCB(进程控制块)组成。

## 进程的特征

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="441px" viewBox="-0.5 -0.5 441 111" content="&lt;mxfile host=&quot;www.draw.io&quot; modified=&quot;2020-01-19T08:38:05.807Z&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36&quot; etag=&quot;m7_rVWupq6HZfgc4T244&quot; version=&quot;12.5.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;BMVjewHNiOEkjeOGXAOx&quot; name=&quot;第 1 页&quot;&gt;1ZfNbqswEIWfZpaVAAcwS6A0baWusrjq0sVTQCI4Mk4T+vTXgAlBpGqvVOWSVezjGf98Ph4RIPH2uJZsl78IjiU4Fj8CuQfHse3A1T+t0vSKZzm9kMmCm6BR2BSfaETLqPuCYz0JVEKUqthNxVRUFaZqojEpxWEa9i7K6ao7luFM2KSsnKt/Cq7yXqWOP+qPWGT5sLLtBf3Ilg3B5iR1zrg4nEkkARJLIVTf2h5jLFt4A5c+7+GL0dPGJFbqJwmfj2uu1s9NToKntNq8hnW+uTOzfLBybw4MCYXoAYIIEh9CCrRr0ACiABIXogSoSapVM1DSK+kLQTMZSoXHL3dpn86uTYNii0o2OsQkOJbB1Qz9vns4g2+k/Iw7MRoz152dJh6J6IaB8g+AnAuAXKBhiybxQO9F4+gboT/jIsW+4tjObwOJfgXPhI5t/Wc8ZI5n5g2uH5TpYvkmDskoRJ2gB1oohX51J0pt1oRRLfYyxe+trJjMUH1/oz9gLrFkqviY7uPXEa4uOky/tsjrrKbf4jUdZq8WZjH39iy2WpjFvAsW89vKHsZdlY+6Kn+9IuYtzGL+7VnMW5jF6OUqFgN1WmeF9xC6V7QYoQuzWHB7FqNXs5jujt/B3djZvwmS/AU=&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:111px;"><defs/><g><ellipse cx="220" cy="15" rx="40" ry="15" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="219.5" y="19.5">进程特征</text></g><rect x="0" y="80" width="80" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="39.5" y="99.5">动态性</text></g><path d="M 220 30 L 220 45 Q 220 55 210 55 L 50 55 Q 40 55 40 64.32 L 40 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 40 78.88 L 36.5 71.88 L 40 73.63 L 43.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="120" y="80" width="80" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="159.5" y="99.5">并发性</text></g><path d="M 220 30 L 220 45 Q 220 55 210 55 L 170 55 Q 160 55 160 64.32 L 160 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 160 78.88 L 156.5 71.88 L 160 73.63 L 163.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="80" width="80" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="279.5" y="99.5">独立性</text></g><path d="M 220 30 L 220 45 Q 220 55 230 55 L 270 55 Q 280 55 280 64.32 L 280 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 280 78.88 L 276.5 71.88 L 280 73.63 L 283.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="360" y="80" width="80" height="30" rx="4.5" ry="4.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="399.5" y="99.5">异步性</text></g><path d="M 220 30 L 220 45 Q 220 55 230 55 L 390 55 Q 400 55 400 64.32 L 400 73.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 400 78.88 L 396.5 71.88 L 400 73.63 L 403.5 71.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/></g></svg>

## 进程的三种基本状态

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="322px" viewBox="-0.5 -0.5 322 332" content="&lt;mxfile host=&quot;www.draw.io&quot; modified=&quot;2020-01-19T08:44:39.662Z&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36&quot; etag=&quot;EqGB0ifD7l267HTvRaLF&quot; version=&quot;12.5.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;Pt4exMKVwKLpky3FDK4F&quot; name=&quot;第 1 页&quot;&gt;1VjLcpswFP0aLZtBwuaxBIc06bSTdLJo0k1HMSqoBeQRcmzn63sF4mXsNO0kdrxC90hXoHM4VwJkz/L1R0kX6RcRswwRK14j+xwRgrE/hYtGNjXiWKQGEsljM6gDbvkTM6Bl0CWPWTkYqITIFF8MwbkoCjZXA4xKKVbDYT9FNrzrgiZsBNzOaTZGv/FYpTXqEbfDLxlP0ubO2PHrnpw2g81KypTGYtWD7AjZMymEqlv5esYyTV7DS513sae3fTDJCvWSBBn9uMHf7/Dl5uunK4mv8+Qm/2CWUapNs2AWw/pNWIgCLqEUyyJmehoLIiFVKhJR0OyzEAsAMYC/mFIbox5dKgFQqvLM9LI1V3c6/YxMTXjf6zpfm6mrYNMEhZKbfpaO7/udXV4VNYn1kvQ69jJloFIs5Zw9Q0/zxlGZMPXMOLvVE4zARM7geSBPsowq/jh8DmreyKQd14kGDaPbP2ho5n2k2dLcCUVTFFooxChyURiiIBjJ3GmqVVilXLHbBa3IWIGTh/rRh1JkS8UCOTcaV2gXTSAslRS/W5OQVohHJhVbPy/FmDqTQCbGPaZ8uCZcdV7ETalIez5s0l6fbGtE5ds6pm8Y64WGGbjlbHo4v5AX+mWP6IfxC9nhFx/5nnYKGCfAyI9O1S/O0C6tD47mF+/AdnH/xy8mq7EMPpxh7FMwjH9YDfsCtuXvrxK+dwXJMRW0d5Q8B3k+ClwUebrkebNTLXnbRwTbOXbNw7tOZLC9XCA/1CeywENeWCEW8uzqsBagwBkJAJyoLZYznhTQngM3TAKgmePwtRKYjpzHcVbZkZX8iT5UU+k3fiF4oaqFTkM0PddzgQPLTqrXUAJv7T5krISzQwjyZkLs2uod5MOh2Kn2fGhMtCLgBM+tNv9olxNOTQibvDchxgXoCia6rorPBQpdLQt8rnjk5LnH9lY5so/NvbOP++Z111uBh/zxl82pc48n/ltxD2H366bq6/0As6M/&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:332px;"><defs/><g><path d="M 208.5 41 L 208.5 284.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 208.5 289.88 L 205 282.88 L 208.5 284.63 L 212 282.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="181" y="1" width="110" height="40" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 21px; margin-left: 183px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">就绪</div></div></div></foreignObject><text x="236" y="25" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">就绪</text></switch></g><path d="M 56 171 L 176.92 25.89" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 180.28 21.86 L 178.49 29.48 L 176.92 25.89 L 173.11 25 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="1" y="171" width="110" height="40" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 191px; margin-left: 3px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">阻塞</div></div></div></foreignObject><text x="56" y="195" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">阻塞</text></switch></g><path d="M 263.5 291 L 263.5 47.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 263.5 42.12 L 267 49.12 L 263.5 47.37 L 260 49.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 181 311 L 60.97 214.98" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 56.87 211.7 L 64.53 213.34 L 60.97 214.98 L 60.15 218.8 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="181" y="291" width="110" height="40" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 311px; margin-left: 183px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">执行</div></div></div></foreignObject><text x="236" y="315" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">执行</text></switch></g><rect x="151" y="151" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 161px; margin-left: 181px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">进程调度</div></div></div></foreignObject><text x="181" y="165" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">进程调度</text></switch></g><rect x="261" y="151" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 161px; margin-left: 291px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">时间片完</div></div></div></foreignObject><text x="291" y="165" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">时间片完</text></switch></g><rect x="71" y="261" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 271px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">I/O请求</div></div></div></foreignObject><text x="101" y="275" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">I/O请求</text></switch></g><rect x="71" y="80" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 90px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">I/O完成</div></div></div></foreignObject><text x="101" y="94" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">I/O完成</text></switch></g></g></svg>

假如说是五种状态，就在加入挂起和激活状态就可以了，其实也还是根据上边这个图来的。

## 为什么要引入生产者与消费者关系

举一个例子吧。

```c++
int a = 2,b = 3;
① a = a + b;
② b = a * b;
```

把①和②当做两个进程，当他们两个顺序执行时可以得到的结果是`a=5`,`b=15`，这个才是正常的。
但是当两者随着运算顺序的不同，得到的结果也相异，有以下三种情况

+ 进程①比进程②运算的快的时候 `a=5`,`b=15`
+ 当进程①跟进程②同时运行的时候 `a=5`,`b=6`
+ 当进程①比进程②运算慢的时候 `a=8`,`b=6`

这还只是两个进程，有三种结果，当程序多的时候，结果的基数也会变得很大，但是我们要的只是正确的那一个，所以我们要防止这种情况出现，生产者与消费者关系就可以很好的解决这样的情况。

## 生产者与消费者关系

生产者和消费者中间还有一个缓冲区，生产者生产完的东西就放在缓冲区里，消费者获取东西也要从缓冲区里面取。但是它们之间必须要有这样的约定，不允许生产者向一个一个已经装满了商品且尚未取走的缓冲池投放产品，不允许消费者从一个空的缓冲池取产品。

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="502px" viewBox="-0.5 -0.5 502 342" content="&lt;mxfile host=&quot;www.draw.io&quot; modified=&quot;2020-01-19T08:54:50.348Z&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36&quot; etag=&quot;XnaWMI6m6iQM4HBxsvy8&quot; version=&quot;12.5.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;1X1_4D_LLYdusR2sA2wP&quot; name=&quot;第 1 页&quot;&gt;5VnLctowFP0aLZux/PYSA2ky03bDoulS2MJWKluMEMHk6yvb8isCJpkhMdAN6B49rHuu7pFkA2uaFd85Wqc/WYwpMI24ANYMmCaEgSP/SmRfI65h1kDCSawadcCCvGIFGgrdkhhvBg0FY1SQ9RCMWJ7jSAwwxDnbDZutGB0+dY0SrAGLCFEd/U1ikdaob3od/oBJkjZPhm5Q12Soaaw82aQoZrseZM2BNeWMibqUFVNMS/IaXup+90dq24lxnIv3dHiaZktKi2j5/Jg/TH6RMHiMvqlRXhDdKofVZMW+YYCzbR7jchAIrHCXEoEXaxSVtTsZc4mlIqOqGi03jG4FnvBIxbJCO8uW5kZw9relUxIRqllgLnBx1D3YkiZXG2YZFnwvm6gOvqJ536wfZe+6qLVY2ouYZSsQqZWStEN3ZMqC4vMD3Jo6t3MPhFMQWGDuAN8FoUTkLwQTA2q8SyrEG3IpSXJZjiQlmEugJIzItTpRFRmJ47J7yPGGvKJlNZQh7TUjuaj8c0LgzMqxtoJtugidIQAtuyci4B4IgPlZ/Fs3s7YvcHHbN0OufXnkOh9RDp34a1MO69KUw/0I/9bV8+9cGv/Q1jjFsTyWKTNneUVVqy8lUYyLlCUsR/QHY2tFzjMWYq8UpORtGBVcEPHUK/9RQ5XlWdE39o2RS/ee+kbV585pzK5bZTX9andKH06HSLrMtjzCJ7hRB0+BeILFiXbB4ZBzTJEgL8N5nD+AzmgBhLcSQHgkab8mgt5BCQxsENyDuQ3CCZh4YO4DuXn6erCvZOtvLqdK91qR6+med0D3Pm3fh+54undnOicz54wZ4L83A8wxM8DXMmCcI+6KUDpllPHqkdZqhd0oalv2amIvWBrGeTJDSw04cmoEWjT0G/OVqM5bbqEztux4I8qOd1p2jm3Y3hfu2M3av3DBaqbZyxH9bvL/KJY3dlbp71b1a82VSlb76mM0cg+9XJUXchf4fnksDeURNbj686n9dQdUaXafIqq63gcda/4P&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:342px;"><defs/><g><rect x="1" y="1" width="100" height="340" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><rect x="21" y="1" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 11px; margin-left: 51px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">缓冲池1</div></div></div></foreignObject><text x="51" y="15" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">缓冲池1</text></switch></g><rect x="201" y="1" width="100" height="340" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><rect x="401" y="1" width="100" height="340" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><rect x="221" y="1" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 11px; margin-left: 251px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">缓冲池2</div></div></div></foreignObject><text x="251" y="15" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">缓冲池2</text></switch></g><rect x="421" y="1" width="60" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 11px; margin-left: 451px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; ">缓冲池3</div></div></div></foreignObject><text x="451" y="15" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">缓冲池3</text></switch></g><path d="M 86 161 L 210.76 74.62" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 215.08 71.64 L 211.32 78.5 L 210.76 74.62 L 207.33 72.74 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 86 201 L 210.22 258.33" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 214.98 260.53 L 207.16 260.78 L 210.22 258.33 L 210.1 254.42 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="16" y="161" width="70" height="40" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 181px; margin-left: 18px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">生产者</div></div></div></foreignObject><text x="51" y="185" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">生产者</text></switch></g><path d="M 286 121 L 410.02 166.1" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 414.95 167.89 L 407.17 168.79 L 410.02 166.1 L 409.57 162.21 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="216" y="111" width="70" height="40" rx="7" ry="7" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 131px; margin-left: 218px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">2</div></div></div></foreignObject><text x="251" y="135" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">2</text></switch></g><rect x="216" y="51" width="70" height="40" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 71px; margin-left: 218px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">1</div></div></div></foreignObject><text x="251" y="75" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">1</text></switch></g><path d="M 286 201 L 409.65 191.49" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 414.89 191.09 L 408.17 195.11 L 409.65 191.49 L 407.64 188.13 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="216" y="171" width="70" height="40" rx="7" ry="7" fill="#ffe6cc" stroke="#d79b00" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 191px; margin-left: 218px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">3</div></div></div></foreignObject><text x="251" y="195" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">3</text></switch></g><rect x="216" y="241" width="70" height="40" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 261px; margin-left: 218px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">4</div></div></div></foreignObject><text x="251" y="265" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">4</text></switch></g><rect x="416" y="161" width="70" height="40" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 181px; margin-left: 418px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">消费者</div></div></div></foreignObject><text x="451" y="185" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">消费者</text></switch></g></g></svg>

生产者可以选择1或4把生产的产品放进去，消费者可以选择2或3买走商品。

## 程序代码实现

```c++
while(true){
    进入区;
    临界区;
    退出去;
    剩余区;
}
```

实现原理，当生产者要生产东西的时候，需要判断是否有消费者正在买东西，如果没有消费者就在找找在缓冲池中还有空的缓冲区不，有就放进去，没有就结束。当消费者要买东西时，需要判断是否有生产者正在生产东西，如果没有进去找一个不是空的买，然后结束。思路流程图如下。

```c++
int n;//代表缓冲区的数量
int num=n;//代表缓冲池还剩几个空缓冲区
int flag=0;//标记当前临界区即缓冲池是否有人访问
```

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="651px" viewBox="-0.5 -0.5 651 1082" content="&lt;mxfile host=&quot;www.draw.io&quot; modified=&quot;2020-01-19T09:12:35.032Z&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36&quot; etag=&quot;ewJ7x_zy8RrqBKCi4v3R&quot; version=&quot;12.5.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;xgZ2q8kbPS0n8T-3-S8y&quot; name=&quot;第 1 页&quot;&gt;7VtLk5s4EP41HGcKiffReOzdSiVVUzWHbE5bCmgwG0AsyGN7f/1KIJ7GLjK2YOzkZNRqCaGvv+7Ww4q2jPd/ZCjdfCE+jhSo+ntFe1IgBMAx2A+XHEqJqcJSEGShL5QawUv4HxZCVUi3oY/zjiIlJKJh2hV6JEmwRzsylGVk11V7JVH3rSkK8JHgxUPRsfRr6NNNKbWh1cj/xGGwqd4MTKesiVGlLL4k3yCf7FoibaVoy4wQWj7F+yWO+ORV81K2W5+orQeW4YSOafDpWcvjB9v4+iMwg6W2Sj89+w9AE4Ojh+qLsc8mQBRJRjckIAmKVo3Uzcg28THvVmWlRuczISkTAib8B1N6EGiiLSVMtKFxJGrxPqR/8eaPhih9a9U87UXPReHQKjzjLIwxxZmQlWPnAz45J0KUk23m4XMTIWwLZQGmZ/RgjRwzeUzYaLIDa5fhCNHwrTsOJGwvqPUaeNiDQOhn0Cr7fUPRVrxJgWbEhuu+EvbBbRjNf7ekqnjICyAWTAHY6b6pZE9B8bsyFHep2Cp/WFiK7Vb9smGWXQvFvrHkNCM/ambALszM4lOuF+8D7hweXyOy8zYoo485m2f6N9fZbUKKX1JUgLNjavVb3nBG8f48sMdAiAZaxbra7ZTFXcNhoAnZpsXfSu/60Ok3Q7SEfW+rES9+a9c1zYpSp51EhsKRDNXmZCiUxlBLcXTFWSsrXXEXnKQrmxPWNviAV6bimoptc6HLFJxW7UgiC64yZFAU4YgwysY9Oh9xPW2h3WnYMoNBhjeGzTtGmScsGPBey7lg5ge16zgD6HSdARjyBs6k3sC4GW8wEHbf6yGu6Ay0kc5An9MZaJKcwWuEgnJK15LjtI+9MA9JIi9Qs1T60eiwE1rH7ISqccxOoEqjp3kz9PygwVofyU9jTn7qcvkJxpKzGw2HiNayEvQ9J9GW4kUTNLshVB8M1dfIqdVuGNXhQBi1BsKoJY2n1qw8bbG04az8MCqbu8ZI7ppzchfYc0IPfnHorTmhN0667TxFiZw11mrNN0icdr5Vvuz28y1Dmz/fcm4m3/qYyyFzJG/tOXkL590Cu9hl+wt+nsCKCUlwKVmHfAqkoHkBSqLpMwmLLLZifm9L1NF7dC6tR7RqsGZfjQ4ttZQr5Kff43Tdi6X1jiXOq1ejagytfH9jdvWMvN8STUkRJNnG7BHF3FcX3SXdJfpthgwAuhCZ9uwBoz5T+x0w3udirJEBA8x63gVn3Sa9PMmfLGJcmo8Pu2bDmCZimNbPhYy+/iQxw5ogZhQC9R5iht4znY8QM+DNxIz544M9Mj44c4YH+yQlL9u/5ZRkPpsT0723TVyg9df/9sD6f9ptXPhrHre08gMvQnkeep0UAVyX0c7YjE8dtp9pKO1IirL1kenIwHojbO4fyTgDYXbiIxlVEoJ8d9Z1FUfjl12cJ/l7sZPfUQPqEHqT3lKDt3MddP4cCcCJkqThVZDWu9Xk9Dl9YnV2rQVR9fny0q+He0u+dNP6eMnX6YXtpVcWmZ+2lcXoO0psXmkPqSgMEp4esfkt7hLy2Q89FC1ERRz6fumDMBsO+l50xWkuthxYv4arGE+8L+Z28gbuK6AJ9S4BjYFrhUPeG0qD8nT2dPn9cOZtFua9QmmADwaldjqN+s3K86zsZVWWMzeU8v61cedQ9vef54dSVspz9w623v+toBy45DstlLIuZ98/lJMhyYrN3yPLZUvzJ1Nt9T8=&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:1082px;"><defs/><g><path d="M 325 61 L 325 94.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 325 99.88 L 321.5 92.88 L 325 94.63 L 328.5 92.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="325" cy="31" rx="65" ry="30" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 31px; margin-left: 262px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px">开始</font></div></div></div></foreignObject><text x="325" y="35" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">开始</text></switch></g><path d="M 325 161 L 325 204.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 325 209.88 L 321.5 202.88 L 325 204.63 L 328.5 202.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 303.15 161 L 236 161 Q 230 161 233.53 156.15 L 270.17 105.85 Q 273.7 101 279.7 101 L 414 101 Q 420 101 416.47 105.85 L 379.83 156.15 Q 376.3 161 370.3 161 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 188px; height: 1px; padding-top: 131px; margin-left: 232px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px">生产者/消费者</font></div></div></div></foreignObject><text x="325" y="135" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">生产者/消费者</text></switch></g><path d="M 325 311 L 325 354.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 325 359.88 L 321.5 352.88 L 325 354.63 L 328.5 352.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 325 211 L 427.5 261 L 325 311 L 222.5 261 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 203px; height: 1px; padding-top: 261px; margin-left: 225px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px">flag=0?</font></div></div></div></foreignObject><text x="325" y="265" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">flag=0?</text></switch></g><path d="M 325 431 L 325 464.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 325 469.88 L 321.5 462.88 L 325 464.63 L 328.5 462.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="361" width="170" height="70" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 396px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px">flag=1</font></div></div></div></foreignObject><text x="325" y="400" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">flag=1</text></switch></g><path d="M 222.5 521 L 158 521 L 157.53 614.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 157.51 619.88 L 154.04 612.86 L 157.53 614.63 L 161.04 612.9 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 427.5 521 L 493 521 L 492.53 614.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 492.51 619.88 L 489.04 612.86 L 492.53 614.63 L 496.04 612.9 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 325 471 L 427.5 521 L 325 571 L 222.5 521 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 203px; height: 1px; padding-top: 521px; margin-left: 225px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="font-size: 18px">生产者？</span></div></div></div></foreignObject><text x="325" y="525" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">生产者？</text></switch></g><path d="M 157.5 721 L 157.5 764.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 157.5 769.88 L 154 762.88 L 157.5 764.63 L 161 762.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 55 671 L 35 671 L 35 881 L 160 881" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 157.5 621 L 260 671 L 157.5 721 L 55 671 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 203px; height: 1px; padding-top: 671px; margin-left: 57px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="font-size: 18px">num&lt;n?</span></div></div></div></foreignObject><text x="158" y="675" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">num&lt;n?</text></switch></g><path d="M 492.5 721 L 492.5 764.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 492.5 769.88 L 489 762.88 L 492.5 764.63 L 496 762.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 595 671 L 615 671 L 615 881 L 490 881" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 492.5 621 L 595 671 L 492.5 721 L 390 671 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 203px; height: 1px; padding-top: 671px; margin-left: 392px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="font-size: 18px">num&gt;0?</span></div></div></div></foreignObject><text x="493" y="675" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">num&gt;0?</text></switch></g><path d="M 157.5 841 L 158 881 L 325 881 L 325 914.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 325 919.88 L 321.5 912.88 L 325 914.63 L 328.5 912.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="72.5" y="771" width="170" height="70" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 806px; margin-left: 75px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px">num=num+1</font></div></div></div></foreignObject><text x="158" y="810" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">num=num+1</text></switch></g><path d="M 325 991 L 325 1014.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 325 1019.88 L 321.5 1012.88 L 325 1014.63 L 328.5 1012.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="240" y="921" width="170" height="70" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 956px; margin-left: 242px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="font-size: 18px">flag=0</span></div></div></div></foreignObject><text x="325" y="960" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">flag=0</text></switch></g><ellipse cx="325" cy="1051" rx="65" ry="30" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 1051px; margin-left: 262px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="font-size: 18px">结束</span></div></div></div></foreignObject><text x="325" y="1055" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">结束</text></switch></g><path d="M 492.5 841 L 493 881 L 325 881 L 325 914.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 325 919.88 L 321.5 912.88 L 325 914.63 L 328.5 912.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="407.5" y="771" width="170" height="70" rx="7" ry="7" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 168px; height: 1px; padding-top: 806px; margin-left: 410px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 18px">num=num-1</font></div></div></div></foreignObject><text x="493" y="810" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">num=num-1</text></switch></g><rect x="180" y="501" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 511px; margin-left: 195px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><font style="font-size: 18px">是</font></div></div></div></foreignObject><text x="195" y="515" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">是</text></switch></g><rect x="450" y="501" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 511px; margin-left: 465px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><font style="font-size: 18px">否</font></div></div></div></foreignObject><text x="465" y="515" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">否</text></switch></g><rect x="160" y="731" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 741px; margin-left: 175px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><font style="font-size: 18px">是</font></div></div></div></foreignObject><text x="175" y="745" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">是</text></switch></g><rect x="490" y="731" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 741px; margin-left: 505px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><font style="font-size: 18px">是</font></div></div></div></foreignObject><text x="505" y="745" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">是</text></switch></g><rect x="620" y="711" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 721px; margin-left: 635px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><font style="font-size: 18px">否</font></div></div></div></foreignObject><text x="635" y="725" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">否</text></switch></g><rect x="0" y="711" width="30" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 721px; margin-left: 15px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: nowrap; "><font style="font-size: 18px">否</font></div></div></div></foreignObject><text x="15" y="725" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">否</text></switch></g></g></svg>

**代码**

```cpp
#include<bits/stdc++.h>
using namespace std;
int main()
{
    int m;//代表有几个满缓冲池
    int n;//代表缓冲区的数量
    int flag;//标记当前临界区即缓冲池是否有人访问,0是没人,1是有人
    int key;//输入1和2，代表生产者或者消费者
    cin >> n >> m >> key >> flag;
    int num=m;//代表缓冲池有几个慢缓冲区
    if(key==1){
        if(!flag){
            flag=1;
            if(num<n){
                cout << "生产者找到个空缓冲池放进去";
                num+=1;
            }
            else{
                cout << "已经满了";
            }
            flag=0;
        }
    }
    else{
        if(!flag){
            flag=1;
            if(num>0){
                cout << "消费者找到了个满缓冲区买走";
                num-=1;
            }
            else{
                cout << "空的";
            }
            flag=0;
        }
    }
    if(flag){
        cout << "被占用";
    }
    return 0;
}
```