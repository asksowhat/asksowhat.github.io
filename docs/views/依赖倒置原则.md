---
title: 依赖倒置原则
date: 2020-02-16
categories:
 - Note
tags:
 - 设计模式
---
## 依赖倒置原则（Dependence Inversion Principle）

依赖倒置原则说的是：

+ 高层模块不应该依赖底层模块，二者都应该依赖其抽象。

+ 抽象不应该依赖于细节，细节应该依赖抽象。

+ 依赖倒置的中心思想是面向接口编程。

+ 依赖倒置原则设计理念：相对于细节的多变性，抽象的东西更稳定。以抽象为基础搭建的架构比以细节为基础的架构要稳定的多。在java中，抽象指的是接口或者抽象类，细节就是具体的实现类。

+ 使用接口或抽象类的目的是制定好规范，而不涉及任何具体的操作，展现细节的任务交给它们的实现类去完成。

## DIP例子

完成Person接受消息的功能

```java
public class Main {
	public static void main(String[] args) {
		Person person = new Person();
		person.receive(new Email());
	}
}

class Email {
	public String getInfo() {
		return "hello world";
	}
}

class Person {
	public void receive(Email email) {
		System.out.println("收到消息："+email.getInfo());
	}
}
```

这样就实现了一个简单的接受消息功能。

但是，现在想一个问题，在现实生活中我们并不仅仅只是接收Email消息，还可能接收微信，手机短信等。那么现在只有一个接收的方法，并且接收的是email消息，也就是说现在，对于接受来的消息不加判断，都是email消息，这是与现实相违背的。

所以应该用一个接口来实现各种类型的消息，细节应该依赖于抽象。

```java
import org.omg.CORBA.IRObject;

public class Main {
	public static void main(String[] args) {
		Person person = new Person();
		person.receive(new New());
	}
}

class Email implements IReceiver{
	public String getInfo() {
		return "Email: hello world";
	}
}

class Weixin implements IReceiver {

	@Override
	public String getInfo() {
		return "Weixin: hello world";
	}
}
class New implements IReceiver {

	@Override
	public String getInfo() {
		return "New: hello world";
	}
}
class Person {
	public void receive(IReceiver receiver) {
		System.out.println(receiver.getInfo());
	}
}
interface IReceiver {
	public String getInfo();
}
```

有点像开闭原则，应该是取到了交集吧以后，抽象不应该依赖于细节，细节应该依赖于抽象。记住。

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="611px" viewBox="-0.5 -0.5 611 354" content="&lt;mxfile host=&quot;www.draw.io&quot; modified=&quot;2020-02-17T07:42:20.493Z&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36&quot; etag=&quot;JeCaF2OuROcgflOs9SyM&quot; version=&quot;12.7.0&quot;&gt;&lt;diagram id=&quot;KMxC7J5TO2hK7lTB8quv&quot; name=&quot;第 1 页&quot;&gt;7Vpdc9o6EP01nul94A62wYRHDCRpJmkz5d5p2pc7AgusiWxxZREgv74rWwLLNoQkfD0w00m9K2nX2nN8vHJiud1occPRNHxgAaaWUw8WltuzHMduOI4l/9WDZeZpecox4SRQk9aOAXnFyllX3hkJcGJMFIxRQaamc8TiGI+E4UOcs7k5bcyomXWKJrjkGIwQLXt/kkCEmffKaa39t5hMQp3Z9trZSIT0ZLWTJEQBm+dcbt9yu5wxkV1Fiy6msni6Ltm66w2jqxvjOBa7LIjt78FdEvVe7mLnxvtv+KN9M681FBoviM7Ujv9NsLphsdRVwHHQkcUEi01xbLk+eBRYNuzED1ASYpnIBiMUEVWXcG98+QRG/e+mNn9JUxu9hWEtlTVmsdDx5cLyZjUZEJ9g5SK/h973/mDRv2u7t/3fr8PO8Kmm4MCBgbMq0Q1mEYa8MGG+Rtf2FGQcUyTIi0kFpBg1Wa1dhXtkBG7PqSv2u66KsyzE1SESNuMjrFbloXsjkFMvBMqqUAoEF7k9rl0pM97DkkaJJdsoMqRs9FwkBYxfE5lWoW3QJ8+YBRE5woC14gtcr+kijWWeO09545dJuc+yLANqC8u0XJ0zHe2myaKG/UE6Om0zkOscmY7NI9Jxg4DZ+6LWOQiT296TMB2dCa0TMMH+nMh8ROA+IUyt8xemZkGY3A+/J1tHo2N1sUtsfEAkLjEymZOIohhrcqgRyStEyQTaq94IgMYcHC+YCwLtaEcNCDYF7ygkNLhHSzaTkCYCjZ615YeMk1cIizRxYZhrBjqeMWMgVyqOcZzAnEfNMbvgekALY+I9SoRyjBilaJqQ4WobEdSZxD4TgkUGheV28MLgSYnVZc7p906BJ7Zug6o4Gea68iKf8pQ0OPBewN235YeSFOhEcPa8OkLIGo1BdLqMMkC5F7N0kkaf4rGowD4iQUDTYFM0IvHkH8mFXs1ee+7ThT137fmhqiBdnAkkUIaShISiIaaPLCGCMBmfZ3P9qXw+0lI1favZSz1cdFkMm0AkxQoD+nMsGbAbsJsflzLausn1dgP36kDYVvW8fnqwI/GXvyy3IwcZhCgiDnUQK8QLCL8f9OyBN/FtlPGVLgZrxzR904VAlfScVsTcxNaHenbliwhQdrpg22v7ZMC7jd2A1wTZO/LtCuQ9mj4ZBtLe/zN5eFdqlzGiPl3Az7Q69cxfSxGUY43cmCRJTUEvx5Tgr2LC1UT9n2YGuOPK5PINUktSdZdx7OaWJCnFyim6jtXxicw/RtBMgOmv8kIBs9Tm7Qz5oW5GJzhQ/G8owrm9DYt5wTct+sJ0s/rTlI5ob775D9Eke/5XPNkPEcpRZEbogb7GY6ZVbCA4KMkOiG8rVUEEq2WsoHU5wRqnLbjRLDvKvkYRoVIbbjF9wTKq2Zjvo7Nwm0Zn4bgVnUW7QoOKB6e9aZA+m+dEqA9vHnppJvfUTG46Ap+sl7TLn2IvzeQ7eop6Ndxn0k3aVUeFLVp86Sn3i//Jm0q7fJ74icni8nngYJ8HzkDSd/hQfZH0Nx6Z85V07yLph5X07fifXtLLv334hucXPd+Tnjeuzk7Pry56/pnnuXXeel713e+i50fD/4B6Dub6D62y3/at/1zN7f8B&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:354px;"><defs><clipPath id="mx-clip-224-39-152-26-0"><rect x="224" y="39" width="152" height="26"/></clipPath><clipPath id="mx-clip-4-329-152-26-0"><rect x="4" y="329" width="152" height="26"/></clipPath><clipPath id="mx-clip-224-329-152-26-0"><rect x="224" y="329" width="152" height="26"/></clipPath><clipPath id="mx-clip-454-329-152-26-0"><rect x="454" y="329" width="152" height="26"/></clipPath></defs><g><path d="M 300 60 L 300 127.76" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 293.5 115.88 L 300 128.88 L 306.5 115.88" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 95px; margin-left: 300px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 15px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Use</div></div></div></foreignObject><text x="300" y="100" fill="#000000" font-family="Helvetica" font-size="15px" text-anchor="middle">Use</text></switch></g><path d="M 80 290 L 194.61 184.56" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 204.18 175.76 L 199.01 189.34 L 190.21 179.78 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 300 290 L 300 234.12" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 300 221.12 L 306.5 234.12 L 293.5 234.12 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 530 290 L 405.75 184.16" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 395.85 175.72 L 409.96 179.21 L 401.53 189.1 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 220 26 L 220 0 L 380 0 L 380 26" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 220 26 L 220 60 L 380 60 L 380 26" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 220 26 L 380 26" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="12px"><text x="299.5" y="17.5">Main</text></g><path d="M 220 30 L 380 30" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-224-39-152-26-0)" font-size="12px"><text x="225.5" y="51.5">+ main(): void</text></g><rect x="205" y="130" width="190" height="90" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 192px; height: 90px; padding-top: 130px; margin-left: 205px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; width: 192px; height: 90px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: none; width: 100%; height: 100%; white-space: nowrap; "><p style="margin: 0px ; margin-top: 4px ; text-align: center"><span style="font-size: 15px ; text-align: left">«interface»</span><br style="font-size: 15px ; text-align: left" /><b style="font-size: 15px ; text-align: left">Name</b></p><hr size="1" /><p style="margin: 0px ; margin-left: 4px"><span style="font-size: 15px">+ getInfo(): String</span><br /></p></div></div></div></foreignObject><text x="205" y="142" fill="#000000" font-family="Helvetica" font-size="12px">«interface»...</text></switch></g><path d="M 0 316 L 0 290 L 160 290 L 160 316" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 0 316 L 0 350 L 160 350 L 160 316" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 0 316 L 160 316" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="12px"><text x="79.5" y="307.5">Email</text></g><path d="M 0 320 L 160 320" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-4-329-152-26-0)" font-size="12px"><text x="5.5" y="341.5">+ getInfo(): String</text></g><path d="M 220 316 L 220 290 L 380 290 L 380 316" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 220 316 L 220 350 L 380 350 L 380 316" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 220 316 L 380 316" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="12px"><text x="299.5" y="307.5">Weixin</text></g><path d="M 220 320 L 380 320" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-224-329-152-26-0)" font-size="12px"><text x="225.5" y="341.5">+ getInfo(): String</text></g><path d="M 450 316 L 450 290 L 610 290 L 610 316" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 450 316 L 450 350 L 610 350 L 610 316" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 450 316 L 610 316" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" font-weight="bold" text-anchor="middle" font-size="12px"><text x="529.5" y="307.5">New</text></g><path d="M 450 320 L 610 320" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-454-329-152-26-0)" font-size="12px"><text x="455.5" y="341.5">+ getInfo(): String</text></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://desk.draw.io/support/solutions/articles/16000042487" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>